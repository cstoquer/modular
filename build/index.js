!function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=o[s]={exports:{}};e[s][0].call(c.exports,function(t){var o=e[s][1][t];return i(o?o:t)},c,c.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,o){function n(){this._events={}}e.exports=n,n.listenerCount=function(t,e){var o=t._events[e];return o?o.length:0},n.prototype.on=function(t,e){if("function"!=typeof e)throw new TypeError("Tried to register non-function as event handler for event: "+t);this.emit("newListener",t,e);var o=this._events,n=o[t];return void 0===n?o[t]=[e]:n.push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(t,e){return e.once?e.once+=1:e.once=1,this.on(t,e)},n.prototype.setMaxListeners=function(){console.warn("Method setMaxListeners not supported, there is no limit to the number of listeners")},n.prototype.removeListener=function(t,e){var o=this._events[t];if(void 0!==o){var n=o.indexOf(e);n!==-1&&(o.splice(n,1),0===o.length&&delete this._events[t],this.emit("removeListener",t,e))}return this},n.prototype.removeAllListeners=function(t){return t?delete this._events[t]:this._events={},this},n.prototype.hasListeners=function(t){return void 0!==this._events[t]},n.prototype.listeners=function(t){var e=this._events[t];return void 0!==e?e.slice():[]},n.prototype.emit=function(t){var e=this._events[t];if(void 0===e)return!1;e=e.slice();for(var o=!1,n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);for(var i=0,r=e.length;i<r;i++){var s=e[i];s.apply(this,n),o=!0,s.once&&(s.once>1?s.once--:delete s.once,this.removeListener(t,s))}return o}},{}],2:[function(t,e,o){function n(t,e,o,n,i,r,s,a){this.x=~~t,this.y=~~e,this.tile=~~o,this.flipH=!!n,this.flipV=!!i,this.flipR=!!r,this.flagA=!!s,this.flagB=!!a}function i(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=new r(t*s,e*a),this._tilesheetPath="",t&&e&&this._init(t,e)}var r=t("../Texture"),s=settings.tileSize[0],a=settings.tileSize[1];n.prototype.draw=function(t){t.sprite(this.tile,this.x*s,this.y*a,this.flipH,this.flipV,this.flipR)},e.exports=i,i.prototype._isMap=!0;var u={},l=[];i.getMap=function(t){return"string"==typeof t?u[t]:"number"==typeof t?l[t]:(console.error("Map does not exist",t),null)},i._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.error("Map bank format incorrect"),{_type:"maps",maps:[]}):t:(console.error("No map bank"),{_type:"maps",maps:[]})},i.loadBank=function(t){t=i._checkBankFormat(t);for(var e=[],o=t.maps||[],n=0;n<o.length;n++)e.push((new i).load(o[n]))},Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&u[this._name]&&u[this._name]===this&&delete u[this._name],this._name=t,t&&!u[t]&&(u[t]=this)}}),i.prototype._init=function(t,e){this.texture.resize(t*s,e*a),this.width=t,this.height=e,this.items=[];for(var o=0;o<t;o++){this.items.push([]);for(var n=0;n<e;n++)this.items[o][n]=null}},i.prototype.resize=function(t,e){var o=this.items,n=Math.min(this.width,t),i=Math.min(this.height,e);this.texture.resize(t*s,e*a),this._init(t,e);for(var r=0;r<n;r++)for(var u=0;u<i;u++)this.items[r][u]=o[r][u];return this.redraw(),this},i.prototype.set=function(t,e,o,i,r,u,l,c){if(null===o||void 0===o)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var d=this.items[t][e]=new n(t,e,o,i,r,u,l,c);return this.texture.ctx.clearRect(t*s,e*a,s,a),d.draw(this.texture),this}},i.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture.ctx.clearRect(t*s,e*a,s,a),this},i.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},i.prototype.redraw=function(){this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]&&this.items[t][e].draw(this.texture);return this},i.prototype.draw=function(t,e){draw(this.texture,t,e)},i.prototype.setTilesheet=function(t){return this._tilesheetPath=t&&t.path||"",this.texture.setTilesheet(t),this.redraw(),this},i.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();t=t.split("/"),fileId=t.pop();for(var e=assets,o=0;o<t.length;o++)if(e=e[t[o]],!e)return console.warn("Could not find tilesheet",t);var n=e[fileId];n&&n instanceof Image&&this.setTilesheet(n)};var c,d;!function(){function t(t){var o=~~(t/i),n=t%i;return e[o]+e[n]}for(var e="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",o={},n=0;n<e.length;n++)o[e[n]]=n;var i=e.length,r=i*i-1,s=Math.pow(2,13),a=r-s-1;c=function(e){str="",count=0;for(var o=0;o<e.length;o++){var n=e[o];n===e[o+1]&&++count<a||(null===n&&(n=r),str+=t(n),count===a&&count--,0!==count&&(str+=t(s+count)),count=0)}return count===a&&count--,0!==count&&(str+=t(s+count)),str},d=function(t){arr=[];for(var e=0;e<t.length;){var n=t[e++],a=t[e++],u=o[n]*i+o[a];if(u===r)arr.push(null);else if(u>s)for(var l=u-s,c=arr[arr.length-1],d=0;d<l;d++)arr.push(c);else arr.push(u)}return arr}}(),i.prototype.save=function(){for(var t=this.width,e=this.height,o=new Array(t*e),n=0;n<t;n++)for(var i=0;i<e;i++){var r=this.items[n][i];o[n+i*t]=r?r.tile+(r.flipH<<8)+(r.flipV<<9)+(r.flipR<<10)+(r.flagA<<11)+(r.flagB<<12):null}var s={w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:c(o)};return s},i.prototype.load=function(t){var e=t.w,o=t.h;this._init(e,o),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var n=d(t.data),i=0;i<e;i++)for(var r=0;r<o;r++){var s=n[i+r*e];if(null!==s){var a=255&s,u=s>>8&1,l=s>>9&1,c=s>>10&1,h=s>>11&1,p=s>>12&1;this.set(i,r,a,u,l,c,h,p)}}return this.redraw(),this},i.prototype.copy=function(t,e,o,n){t=t||0,e=e||0,void 0!==o&&null!==o||(o=this.width),void 0!==n&&null!==n||(n=this.height);var r=new i(o,n);return r.paste(this,-t,-e),r},i.prototype.paste=function(t,e,o,n){e=e||0,o=o||0;for(var i=Math.min(t.width,this.width-e),r=Math.min(t.height,this.height-o),s=Math.max(0,-e),a=Math.max(0,-o),u=s;u<i;u++)for(var l=a;l<r;l++){var c=t.items[u][l];if(c)this.set(u+e,l+o,c.tile,c.flipH,c.flipV,c.flipR,c.flagA,c.flagB);else{if(n)continue;this.remove(u+e,l+o)}}return this.redraw(),this},i.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture.clear(),this},i.prototype.find=function(t,e,o){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===o&&(o=null);for(var n=[],i=0;i<this.width;i++)for(var r=0;r<this.height;r++){var s=this.items[i][r];if(s){var a=null===e||s.flagA===e,u=null===o||s.flagB===o;s.tile===t&&a&&u&&n.push(s)}}return n},i.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var o=0;o<this.height;o++)null===this.items[e][o]&&t.push({x:e,y:o});return t}},{"../Texture":3}],3:[function(t,e,o){function n(t,e){var o=document.createElement("canvas");return o.width=t,o.height=e,o}function i(t,e){this.canvas=n(t,e),this.ctx=this.canvas.getContext("2d"),this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textOffset=1,this._textPadding=e-6*this._textLine-this._textOffset,this.camera={x:0,y:0},this.ctx.fillStyle=this.palette[0],this.ctx.strokeStyle=this.palette[1]}function r(t,e){for(var o=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],n=0;n<e.length;n++){t.fillStyle=e[n];for(var i=0;i<o.length;i++)for(var r=o[i],s=0;s<15;s++){var a=s%3,u=~~(s/3),l=r>>s&1;1===l&&t.fillRect(3*i+a,5*n+u,1,1)}}t.fillStyle=e[0]}var s=settings.tileSize[0],a=settings.tileSize[1],u=16,l=Math.PI/2;e.exports=i,i.prototype._isTexture=!0,i.prototype.palette=["#000000","#FFFFFF"],i.prototype.tilesheet=new i(s*u,a*u),i.prototype.textCharset=new i(384,5*i.prototype.palette.length),i.prototype.resize=function(t,e){return this.canvas.width=t,this.canvas.height=e,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textOffset=1,this._cursor.i=0,this._cursor.j=0,this.clear(),this},i.prototype.setPalette=function(t){i.prototype.palette=t,i.prototype.textCharset=new i(384,5*t.length),r(i.prototype.textCharset.ctx,t)},i.prototype.setGlobalTilesheet=function(t){i.prototype.tilesheet.clear().draw(t,0,0)},i.prototype.setTilesheet=function(t){return t?(this.tilesheet===i.prototype.tilesheet&&(this.tilesheet=new i(s*u,a*u)),this.tilesheet.clear().draw(t,0,0),this):void delete this.tilesheet},i.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this},i.prototype.sprite=function(t,e,o,n,i,r){var c=t%u,d=~~(t/u),h=this.ctx;return e=e||0,o=o||0,e=~~Math.round(e-this.camera.x),o=~~Math.round(o-this.camera.y),n||i||r?(h.save(),n&&(h.scale(-1,1),e*=-1,e-=s),i&&(h.scale(1,-1),o*=-1,o-=a),r?(h.translate(e+a,o),h.rotate(l)):h.translate(e,o),h.drawImage(this.tilesheet.canvas,c*s,d*a,s,a,0,0,s,a),h.restore(),this):(h.drawImage(this.tilesheet.canvas,c*s,d*a,s,a,e,o,s,a),this)},i.prototype.draw=function(t,e,o,n,i,r){t._isMap&&(t=t.texture.canvas),t._isTexture&&(t=t.canvas);var s=~~Math.round((e||0)-this.camera.x),a=~~Math.round((o||0)-this.camera.y);if(!n&&!i&&!r)return this.ctx.drawImage(t,s,a),this;var u=this.ctx;return u.save(),n&&(u.scale(-1,1),s*=-1,s-=t.width),i&&(u.scale(1,-1),a*=-1,a-=t.height),r?(u.translate(s+t.height,a),u.rotate(l)):u.translate(s,a),u.drawImage(t,0,0),u.restore(),this},i.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},i.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},i.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen],this},i.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper],this},i.prototype.rect=function(t,e,o,n){return this.ctx.strokeRect(~~(t-this.camera.x)+.5,~~(e-this.camera.y)+.5,~~(o-1),~~(n-1)),this},i.prototype.rectfill=function(t,e,o,n){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~o,~~n),this},i.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},i.prototype.print=function(t,e,o){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){t="[Object]"}else"string"!=typeof t&&(t=t.toString());if(void 0!==e){e=~~Math.round(e-this.camera.x),o=~~Math.round(o-this.camera.y);for(var n=0;n<t.length;n++)this.ctx.drawImage(this.textCharset.canvas,3*t.charCodeAt(n),5*this._pen,3,5,e,o,3,5),e+=4;return this}for(var n=0;n<t.length;n++){this._cursor.j>=this._textLine&&this.textScroll();var i=t.charCodeAt(n);10!==i&&13!==i?(this.ctx.drawImage(this.textCharset.canvas,3*i,5*this._pen,3,5,4*this._cursor.i,6*this._cursor.j+this._textOffset,3,5),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},i.prototype.println=function(t){return this.print(t),this.print("\n"),this},i.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{}],4:[function(t,e,o){function n(t,e){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===~~o.readyState)return 200!==~~o.status?e("xhr:"+o.status):e&&e(null,JSON.parse(o.response))},o.open("GET",t,!0),o.send()}function i(t,e){var o=new XMLHttpRequest;o.open("POST","req",!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.onreadystatechange=function(){if(4===~~o.readyState){if(200!==~~o.status)return e&&e("xhr:"+o.status);var t=JSON.parse(o.response);return e&&e(t.error,t.result)}},o.send(JSON.stringify(t))}function r(t,e){var o=new Image;o.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},o.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},o.src=t}function s(t,e){function o(){e&&e(null,i),i.removeEventListener("canplaythrough",o),i.removeEventListener("error",n)}function n(){e&&e("snd:load"),i.removeEventListener("canplaythrough",o),i.removeEventListener("error",n)}var i=new Audio;i.preload=!0,i.loop=!1,i.addEventListener("canplaythrough",o),i.addEventListener("error",n),i.src=t,i.load()}function a(t,e){n("build/data.json",function(o,n){function i(t,e){var o=t.split("/"),n=o.pop(),i=n.split(".");i.pop(),i=i.join(".");for(var r=u,s=0,a=o.length;s<a;s++)r=r[o[s]];r[i]=e,o.push(i),e.name=i,e.path=o.join("/")}function a(){var o=h+p,f=o/c;e&&e(h,o,c,f);var m,v;o<l?(m=n.img[o],v=r):(m=n.snd[o-l],v=s),p+=1,v(d+m,function(e,o){e||i(m,o),h+=1,p-=1,h+p<c?a():0===p&&t(null,u)})}if(o)return t(o);var u=n.dat,l=n.img.length,c=l+n.snd.length,d=n.root,h=0,p=0;if(0===c)return t(null,u);for(var f=Math.min(5,c-1),m=0;m<=f;m++)a()})}o.loadJson=n,o.sendRequest=i,o.loadImage=r,o.loadSound=s,o.preloadStaticAssets=a},{}],5:[function(t,e,o){function n(t,e){function o(e){e.preventDefault(),t.style.left=e.clientX-r+"px",t.style.top=e.clientY-s+"px"}function n(t){t.preventDefault(),i.removeEventListener("mouseup",n),i.removeEventListener("mousemove",o)}var i=document;rect=t.getBoundingClientRect();var r=e.clientX-rect.left,s=e.clientY-rect.top;i.addEventListener("mousemove",o,!1),i.addEventListener("mouseup",n,!1)}var i=document.getElementsByTagName("body")[0];o.createDom=function(t,e,o){o=o||i;var n=document.createElement(t);return o.appendChild(n),e&&(n.className=e),n},o.createDiv=function(t,e){return o.createDom("div",t,e)},o.removeDom=function(t,e){e=e||i,e.removeChild(t)},o.makeButton=function(t,e){return t.addEventListener("mousedown",function(o){o.stopPropagation(),o.preventDefault(),e(o,t)}),t},o.makeDragable=function(t,e){return e=e||t,t.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault(),n(e,t)}),t}},{}],6:[function(t,e,o){e.exports={screen:{width:64,height:10,pixelSize:[2,2],fullscreen:!1},tileSize:[8,8],palette:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.1)"],controls:{up:38,down:40,left:37,right:39,A:32,B:88},touchEvent:{multiTouch:!1,disableContextMenu:!1,hideMousePointer:!1},loaderColors:[0,1],components:{TINA:!1,AudioManager:!1}}},{}],7:[function(t,e,o){function n(t,e,o){this.connections=[],a.call(this,t,e,o)}function i(t,e,o){n.call(this,t,e,o)}function r(t,e,o){n.call(this,t,e,o)}var s=t("./connectors"),a=t("./Connector");inherits(n,a),n.prototype.color="#fd870e",n.prototype.type="audio",n.prototype.bind=function(t,e,o){var n=o.endPoint.split(".");this.endPoint=t;for(var i=0;i<n.length;i++)this.endPoint=this.endPoint[n[i]];var r=this.connections;this.connections=[];for(var i=r.length-1;i>=0;i--)this.connect(r[i])},n.prototype.connect=function(t){a.prototype.connect.call(this,t),this._addConnection(t),t._addConnection(this)},n.prototype.disconnect=function(t){a.prototype.disconnect.call(this,t),this._removeConnection(t),t._removeConnection(this)},n.prototype._addConnection=function(t){this.connections.push(t)},n.prototype._removeConnection=function(t){var e=this.connections.indexOf(t);e!==-1&&this.connections.splice(e,1)},inherits(i,n),i.prototype.cssClassName="audioIn",i.prototype.way="input",s.register(i,"input","audio"),i.prototype.connect=function(t){n.prototype.connect.call(this,t),t.endPoint.connect(this.endPoint)},inherits(r,n),r.prototype.cssClassName="audioOut",r.prototype.way="output",s.register(r,"output","audio"),r.prototype.connect=function(t){n.prototype.connect.call(this,t),this.endPoint.connect(t.endPoint)},r.prototype.disconnect=function(t){n.prototype.disconnect.call(this,t),this.endPoint.disconnect(t.endPoint)}},{"./Connector":11,"./connectors":16}],8:[function(t,e,o){function n(t){if(i.call(this,t),this._dom.style.backgroundColor="#7cd4a7",this._dom.style.borderColor="#c1f1d0",this._dom.style.borderRadius="4px",this._title.textContent=t.id,this.buffer=null,!t)return console.warn("Buffer module should be initialized with buffer data.");var e=this;t.loadAudioBuffer(function(o){return o?(console.error("Could not load buffer",t,o),e._dom.style.backgroundColor="#ea455c",void(e._dom.style.borderColor="#dc9797")):(e.buffer=t,void e.onLoad())})}var i=t("../core/Module"),r=t("../ui/moduleLibrary");inherits(n,i),n.prototype.onConnect=function(t){this.buffer&&this.$data.emitTo(t,{_type:"buffer",buffer:this.buffer})},n.prototype.onLoad=function(){this.$data.emit({_type:"buffer",buffer:this.buffer})},n.prototype.descriptor={type:"Buffer",size:1,outputs:{data:{type:"event",x:5,y:0,label:null,onConnect:"onConnect"}}},e.exports=n,r.register(n)},{"../core/Module":14,"../ui/moduleLibrary":37}],9:[function(t,e,o){function n(t,e,o){var n=this._dom=s("moduleButton",t._dom);n.style.left=o.x*i.CONNECTOR_GRID_SIZE+"px",n.style.top=o.y*i.CONNECTOR_GRID_SIZE+"px",o.label&&(s("label knobLabel",n).innerText=o.label),this._title=s("moduleButtonTitle",n),this.bind(t,e,o);var r=this;n.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault(),r.endPoint.call(r.caller)})}var i=t("./constants"),r=t("domUtils"),s=r.createDiv;n.prototype.setTitle=function(t){this._title.innerText=t},n.prototype.bind=function(t,e,o){var n=o.endPoint;if(n){var i=t;n=n.split(".");for(var r=n.pop(),s=0;s<n.length;s++)i=i[n[s]];this.caller=i,this.endPoint=this.caller[r]}},e.exports=n},{"./constants":17,domUtils:5}],10:[function(t,e,o){function n(t,e,o){this.endPointA=t,this.endPointB=e,this.color=o||"#555",this.id=this.getId(t,e),this.x=0,this.y=0,this.a=0,this.b=0,this.c=0,this.d=0,this.w=0,this.h=0,this.update(),t.module.addCable(this),e.module.addCable(this)}var i=t("./constants"),r=t("../ui/overlay").ctx;e.exports=n,n.prototype.getId=function(t,e){return t.module.id+":"+t.id+"--"+e.module.id+":"+e.id},n.prototype.draw=function(){var t=this;r.strokeStyle=t.color,r.beginPath(),r.moveTo(t.x,t.y),r.bezierCurveTo(t.a,t.b,t.c,t.d,t.w,t.h),r.stroke()},n.prototype.update=function(){var t=this;t.x=t.endPointA.module.x*i.MODULE_WIDTH+t.endPointA.x*i.CONNECTOR_GRID_SIZE+8,t.y=t.endPointA.module.y*i.MODULE_HEIGHT+t.endPointA.y*i.CONNECTOR_GRID_SIZE+8,t.w=t.endPointB.module.x*i.MODULE_WIDTH+t.endPointB.x*i.CONNECTOR_GRID_SIZE+8,t.h=t.endPointB.module.y*i.MODULE_HEIGHT+t.endPointB.y*i.CONNECTOR_GRID_SIZE+8;var e=(t.w-t.x)/2,o=(t.h-t.y)/2;t.a=~~(t.x+e*Math.random()+10*Math.random()-5),t.b=~~(t.y+o*Math.random()+10*Math.random()-5),t.c=~~(t.x+e*(Math.random()+1)+10*Math.random()-5),t.d=~~(t.y+o*(Math.random()+1)+10*Math.random()-5)},n.prototype.disconnect=function(){var t=this;t.endPointA&&(t.endPointA.disconnect(t.endPointB),t.endPointB.disconnect(t.endPointA),t.endPointA.module.removeCable(t),t.endPointB.module.removeCable(t)),t.endPointA=null,t.endPointB=null}},{"../ui/overlay":38,"./constants":17}],11:[function(t,e,o){function n(t,e,o){var n=this;this.x=o.x,this.y=o.y,this.singleConnection=void 0!==o.singleConnection&&!!o.singleConnection,this.module=t,this.id=e;var r=this._dom=a("connector "+this.cssClassName,t._dom);o.label&&(a("label connectorLabel",r).innerText=o.label),void 0===this.x?r.style.position="relative":(r.style.left=this.x*s.CONNECTOR_GRID_SIZE+1+"px",r.style.top=this.y*s.CONNECTOR_GRID_SIZE+1+"px"),r.connector=this,r.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault(),i.startConnection(n,t)}),this.bind(t,e,o)}var i=t("./moduleManager"),r=t("./connectors"),s=t("./constants"),a=t("domUtils").createDiv;e.exports=n,n.prototype.cssClassName="connector",n.prototype.color="#2da8ff",n.prototype.type="none",n.prototype.way="input",r.register(n,"input","none"),n.prototype.bind=function(t,e,o){},n.prototype.connect=function(t){this.singleConnection&&i.disconnect(this),t.singleConnection&&i.disconnect(t),i.addCable(this,t,this.color)},n.prototype.disconnect=function(t){},n.prototype.isCompatible=function(t){return t!==this&&(this.type===t.type&&this.way!==t.way)}},{"./connectors":16,"./constants":17,"./moduleManager":18,domUtils:5}],12:[function(t,e,o){function n(t,e){e=e||"",e=e.split("."),endPoint=t;for(var o=0;o<e.length;o++)endPoint=endPoint[e[o]];return endPoint}function i(t,e,o){this.module=t,a.call(this,t,e,o)}function r(t,e,o){a.call(this,t,e,o),this.connections=[],this.onConnect=null,o.onConnect&&(this.onConnect=n(t,o.onConnect))}var s=t("./connectors"),a=t("./Connector"),u="#2da8ff";inherits(i,a),i.prototype.cssClassName="eventIn",i.prototype.color=u,i.prototype.type="event",i.prototype.way="input",s.register(i,"input","event"),i.prototype.bind=function(t,e,o){this.endPoint=n(t,o.endPoint)},i.prototype.connect=function(t){t.connect(this)},inherits(r,a),r.prototype.cssClassName="eventOut",r.prototype.color=u,r.prototype.type="event",r.prototype.way="output",s.register(r,"output","event"),r.prototype.connect=function(t){a.prototype.connect.call(this,t),this.connections.push(t),this.onConnect&&this.onConnect.call(this.module,t)},r.prototype.disconnect=function(t){var e=this.connections.indexOf(t);e!==-1&&this.connections.splice(e,1)},r.prototype.emit=function(t){for(var e=0;e<this.connections.length;e++){var o=this.connections[e];o.endPoint.call(o.module,t)}},r.prototype.emitTo=function(t,e){t.endPoint.call(t.module,e)}},{"./Connector":11,"./connectors":16}],13:[function(t,e,o){function n(t,e,o){this.value=0,this.x=o.x,this.y=o.y,this.min=o.min||0,this.max=void 0!==o.max?o.max:1,this.int=o.int||!1;var n=this._dom=s("knob",t._dom);n.style.left=this.x*r.CONNECTOR_GRID_SIZE+2+"px",n.style.top=this.y*r.CONNECTOR_GRID_SIZE+2+"px",this._mark=s("knob knobMark",n),o.label&&(s("label knobLabel",n).innerText=o.label),this.bind(t,e,o);var i=this;n.addEventListener("mousedown",function(t){function e(t){t.preventDefault();var e=Math.max(-68,Math.min(68,r+n-t.clientY));i._mark.style.transform="rotate("+2*e+"deg)",i.value=e,i.updateValue()}function o(t){t.preventDefault(),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",o),i.updateValue()}t.stopPropagation(),t.preventDefault();var n=t.clientY,r=i.value;document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",o,!1)})}function i(t,e,o,n,i){return n+(i-n)*(t-e)/(o-e)}var r=t("./constants"),s=t("domUtils").createDiv;n.prototype.bind=function(t,e,o){this.id=e,this.module=t,this.valueId=o.value||"value",this.endPoint=t;var n=o.endPoint;if(n){n=n.split(".");for(var i=0;i<n.length;i++)this.endPoint=this.endPoint[n[i]]}this.initValue()},n.prototype.initValue=function(){var t=this.endPoint[this.valueId];void 0===t&&(t=0),this.value=i(t,this.min,this.max,-68,68),this._mark.style.transform="rotate("+2*this.value+"deg)"},n.prototype.updateValue=function(){var t=i(this.value,-68,68,this.min,this.max);this.int&&(t=~~Math.round(t)),this.endPoint[this.valueId]=t},n.prototype.getState=function(){return this.value},n.prototype.setState=function(t){this.value=t,this.updateValue(),this._mark.style.transform="rotate("+2*this.value+"deg)"},e.exports=n},{"./constants":17,domUtils:5}],14:[function(t,e,o){function n(){this.id=null,this.x=null,this.y=null,this.cables={};var t=r("module x"+this.descriptor.size,null);this._title=s("span","",t),this._title.textContent=this.descriptor.name,this._dom=t,t.style.left=-10-u.MODULE_WIDTH+"px",this.createInterface(),t.module=this;var e=this;if(t.addEventListener("mousedown",function(t){c.startDrag(e,t)}),arguments.length){this._arguments=[];for(var o=0;o<arguments.length;o++){var n=arguments[o];n.serialize?this._arguments.push(n.serialize()):this._arguments.push(n)}}}var i=t("domUtils"),r=i.createDiv,s=i.createDom,a=i.removeDom,u=t("./constants"),l=t("./connectors"),c=t("./moduleManager"),d={knob:t("./Knob"),button:t("./Button")};n.prototype.descriptor={},n.prototype.createInterface=function(){if(this.descriptor.inputs)for(var t in this.descriptor.inputs){var e=this.descriptor.inputs[t],o=l.getConnector("input",e.type);o&&(this["$"+t]=new o(this,t,e))}if(this.descriptor.outputs)for(var t in this.descriptor.outputs){var n=this.descriptor.outputs[t],o=l.getConnector("output",n.type);o&&(this["$"+t]=new o(this,t,n))}if(this.descriptor.controls)for(var t in this.descriptor.controls){var i=this.descriptor.controls[t],r=d[i.type];this["$$"+t]=new r(this,t,i)}},n.prototype.rebind=function(){if(this.descriptor.inputs)for(var t in this.descriptor.inputs)this["$"+t]&&this["$"+t].bind(this,t,this.descriptor.inputs[t]);if(this.descriptor.outputs)for(var t in this.descriptor.outputs)this["$"+t]&&this["$"+t].bind(this,t,this.descriptor.outputs[t]);if(this.descriptor.controls)for(var t in this.descriptor.controls)this["$$"+t]&&this["$$"+t].bind(this,t,this.descriptor.controls[t])},n.prototype.setPosition=function(t,e){var o=this._dom.style;this.x=t,this.y=e,o.left=u.MODULE_WIDTH*t+"px",o.top=u.MODULE_HEIGHT*e+"px";for(id in this.cables)this.cables[id].update()},n.prototype.remove=function(){for(var t in this.cables)c.removeCable(this.cables[t]);a(this._dom,null)},n.prototype.addCable=function(t){this.cables[t.id]=t},n.prototype.removeCable=function(t){delete this.cables[t.id]},n.prototype.getState=function(){var t={_type:this.descriptor.type,id:this.id,x:this.x,y:this.y};if(this._arguments&&(t.arguments=this._arguments),this.descriptor.controls){t.controls={};for(var e in this.descriptor.controls)this["$$"+e].getState&&(t.controls[e]=this["$$"+e].getState())}var o=this.descriptor.persistent;if(o){t.persistent=[];for(var n=0;n<o.length;n++)t.persistent.push(this[o[n]])}return t},n.prototype.setState=function(t){if(t.controls)for(var e in this.descriptor.controls)t.controls[e]&&this["$$"+e].setState(t.controls[e]);if(t.persistent)for(var o=0;o<this.descriptor.persistent.length;o++){var e=this.descriptor.persistent[o];this[e]=t.persistent[o]}},n.prototype.select=function(){this._title.className="selected"},n.prototype.deselect=function(){this._title.className=""},e.exports=n},{"./Button":9,"./Knob":13,"./connectors":16,"./constants":17,"./moduleManager":18,domUtils:5}],15:[function(t,e,o){var n=window.AudioContext||window.webkitAudioContext,i=new n;e.exports=i},{}],16:[function(t,e,o){connectors={input:{},output:{}},o.register=function(t,e,o){connectors[e]&&(connectors[e][o]=t)},o.getConnector=function(t,e){if(connectors[t])return connectors[t][e]},t("./Connector")},{"./Connector":11}],17:[function(t,e,o){o.MODULE_WIDTH=92,o.MODULE_HEIGHT=16,o.CONNECTOR_GRID_SIZE=15,function(){var t=document.createElement("style");t.type="text/css";for(var e=o.MODULE_WIDTH-3,n=1;n<10;n++){var i=o.MODULE_HEIGHT*n-3,r=document.createTextNode(".x"+n+" { width: "+e+"px; height: "+i+"px; }");t.appendChild(r),document.getElementsByTagName("head")[0].appendChild(t)}}()},{}],18:[function(t,e,o){function n(){this._idCount=0,this.modules={},this.cables={},this.grid=[[]],this.selectedModules=[],this.moduleLibrary=null,this.registerKeyEvents()}function i(t,e){function o(){return t.apply(this,e)}return o.prototype=t.prototype,new o}function r(t){var e=t._type;if(!e)return t;var o=v[e];return o?o.deserialize(t):t}var s=t("../ui/overlay").ctx,a=t("../ui/overlay").overCtx,u=t("./constants"),l=t("./Cable"),c=t("domUtils"),d=c.createDiv,h=(c.createDom,c.removeDom),p=t("../ui/connectorMenu"),f="url(../img/jack-connect.png) 3 3, auto",m="url(../img/jack-free.png) 2 3, auto";n.prototype.registerKeyEvents=function(){function t(t){switch(t.keyCode){case 8:case 32:s.canvas.style.opacity=s.canvas.style.opacity?"":.4;break;case 46:e.deleteSelectedModules()}}var e=this;document.addEventListener("keydown",t,!1)},n.prototype.addModule=function(t,e){for(void 0===e?e=this._idCount++:this.modules[e]&&console.error("Provided id is already used.");this.modules[e];)e=this._idCount++;return t.id=e,this.modules[e]=t,t},n.prototype._addModuleInGrid=function(t,e,o){e=e||0,o=o||1,this.grid[e]||(this.grid[e]=[]);for(var n=this.grid[e],i=(t.descriptor.size,0),r=o;i<n.length;i++){var s=n[i];if(s.y<o&&s.y+s.descriptor.size>=o){r=s.y+s.descriptor.size,i++;break}if(s.y>=o)break}t.setPosition(e,r),n.splice(i,0,t),r+=t.descriptor.size;for(var a=i+1;a<n.length;a++){var s=n[a];if(s.y>=r)break;s.setPosition(s.x,r),r+=s.descriptor.size}},n.prototype.removeModule=function(t){function e(e){var o=e.indexOf(t);return o===-1?console.error("Module not found."):void e.splice(o,1)}delete this.modules[t.id],t.id<this._idCount&&(this._idCount=t.id),e(this.grid[t.x]),t.remove(),this.drawCables()},n.prototype.deleteSelectedModules=function(){for(var t=this.selectedModules,e=0;e<t.length;e++)this.removeModule(t[e]);this.selectedModules=[]},n.prototype.moveModule=function(t,e,o){if(null!==t.x){var n=this.grid[t.x],i=n.indexOf(t);if(i===-1)return console.error("Module not found in grid.");n.splice(i,1)}this._addModuleInGrid(t,e,o)},n.prototype.startDrag=function(t,e){function o(t){var e=t.x*u.MODULE_WIDTH,o=t.y*u.MODULE_HEIGHT,n=d("dummy",null);return n.style.width=u.MODULE_WIDTH-10+"px",n.style.height=t.descriptor.size*u.MODULE_HEIGHT-10+"px",n.style.left=e+"px",n.style.top=o+"px",n}function n(e){e.preventDefault();var n=e.clientX,i=e.clientY;Math.abs(n-c)<4&&Math.abs(n-c)<4||(m||(m=o(t)),m.style.left=n-c+"px",m.style.top=i-p+"px")}function i(e){if(e.preventDefault(),l.removeEventListener("mouseup",i),l.removeEventListener("mousemove",n),m||null===t.x){if(!m)return void a._addModuleInGrid(t);h(m,null);var o=Math.max(0,~~Math.round((e.clientX-c)/u.MODULE_WIDTH)),r=Math.max(1,~~Math.round((e.clientY-p)/u.MODULE_HEIGHT));o===t.x&&r===t.y||(a.moveModule(t,o,r),a.drawCables())}}var r,s,a=this,l=document;null===t.x?(r=e.clientX-u.MODULE_WIDTH/2,s=e.clientY-u.MODULE_HEIGHT/2):(r=t.x*u.MODULE_WIDTH,s=t.y*u.MODULE_HEIGHT);var c=e.clientX-r,p=e.clientY-s;if(a.selectedModules.indexOf(t)===-1){for(var f=0;f<a.selectedModules.length;f++)a.selectedModules[f].deselect();a.selectedModules=[t],t.select()}var m=null;l.addEventListener("mousemove",n,!1),l.addEventListener("mouseup",i,!1)},n.prototype.startConnection=function(t,e){function o(e){var o=e.clientX,n=e.clientY;if(e.preventDefault(),!(!drag&&Math.abs(o-s)<4&&Math.abs(n-c)<4)){drag=!0,a.clearRect(0,0,a.canvas.width,a.canvas.height),a.beginPath(),a.moveTo(d,h),a.lineTo(o,n),a.stroke();var i=r.elementFromPoint(o,n),u=i&&i.connector;u&&u.isCompatible&&u.isCompatible(t)?document.body.style.cursor=f:document.body.style.cursor=m}}function n(e){if(e.preventDefault(),r.removeEventListener("mouseup",n),r.removeEventListener("mousemove",o),document.body.style.cursor="",a.clearRect(0,0,a.canvas.width,a.canvas.height),!drag)return void i.showDisconnectMenu(e.clientX,e.clientY,t);var s=r.elementFromPoint(e.clientX,e.clientY),u=s.connector;if(u&&u!==t&&(!u||!u.isCompatible||u.isCompatible(t))){var c=l.prototype.getId(u,t),d=l.prototype.getId(t,u);i.cables[c]||i.cables[d]||t.connect(u)}}var i=this,r=document,s=e.clientX,c=e.clientY,d=t.module.x*u.MODULE_WIDTH+t.x*u.CONNECTOR_GRID_SIZE+8,h=t.module.y*u.MODULE_HEIGHT+t.y*u.CONNECTOR_GRID_SIZE+8;drag=!1,r.addEventListener("mousemove",o,!1),r.addEventListener("mouseup",n,!1)},n.prototype.showDisconnectMenu=function(t,e,o){var n=this.findCables(o);0!==n.length&&p.show(t,e,o,n)},n.prototype.disconnect=function(t){for(var e=this.findCables(t),o=0;o<e.length;o++)this.removeCable(e[o])},n.prototype.findCables=function(t){var e=t.module.id+":"+t.id,o=[];for(var n in this.cables){var i=n.split("--");i[0]!==e&&i[1]!==e||o.push(this.cables[n])}
return o},n.prototype.areConnected=function(t,e){var o=t.module.id+":"+t.id,n=e.module.id+":"+e.id;return this.cables[o+"--"+n]||this.cables[n+"--"+o]},n.prototype.addCable=function(t,e,o){if(!this.areConnected(t,e)){var n=new l(t,e,o);this.cables[n.id]=n,this.drawCables()}},n.prototype.removeCable=function(t){this.cables[t.id]&&(t.disconnect(),delete this.cables[t.id],this.drawCables())},n.prototype.drawCables=function(){var t=this.cables;s.clearRect(0,0,s.canvas.width,s.canvas.height);for(var e in t)t[e].draw()},n.prototype.shakeCables=function(){var t=this.cables;s.clearRect(0,0,s.canvas.width,s.canvas.height);for(var e in t)t[e].update(),t[e].draw()},n.prototype.clearPatch=function(){this.selectedModules=[];for(var t in this.cables)this.removeCable(this.cables[t]);for(var t in this.modules)this.removeModule(this.modules[t]);this._idCount=0},n.prototype.getPatch=function(){var t={_type:"modularPatch",version:1,modules:[],cables:[]};for(var e in this.modules)t.modules.push(this.modules[e].getState());for(var e in this.cables)t.cables.push(e);return t};var v={BufferData:t("../data/BufferData")};n.prototype.setPatch=function(t){if(!t||"modularPatch"===!t._type)return console.error("Wrong format");this.clearPatch();for(var e=t.modules||[],o=0;o<e.length;o++){var n=e[o],s=this.moduleLibrary.getModuleConstructor(n._type);if(s){var a;if(n.arguments){for(var u=n.arguments,l=0;l<u.length;l++)u[l]=r(u[l]);a=i(s,u)}else a=new s;this.addModule(a,n.id),this._addModuleInGrid(a,n.x,n.y),a.setState(n)}else console.error("Could not create module of type",n._type)}for(var c=t.cables||[],o=0;o<c.length;o++){var d=c[o];connections=d.split("--"),connectionA=connections[0].split(":"),connectionB=connections[1].split(":"),moduleA=this.modules[connectionA[0]],moduleB=this.modules[connectionB[0]],connectorA=moduleA["$"+connectionA[1]],connectorB=moduleB["$"+connectionB[1]],connectorA.connect(connectorB)}};var y=new n;e.exports=y,window.moduleManager=y},{"../data/BufferData":19,"../ui/connectorMenu":35,"../ui/overlay":38,"./Cable":10,"./constants":17,domUtils:5}],19:[function(t,e,o){function n(t,e){this.id=t,this.buffer=void 0,this.uri=e.uri,this.loop=e.loop,this.start=e.start,this.end=e.end,this.tag=e.tag}var i=t("../core/audioContext");n.initializeDatabase=function(t){for(var e in t)t[e]=new n(e,t[e])},n.deserialize=function(t){return new n(t.id,t)},n.prototype.serialize=function(){return{_type:"BufferData",id:this.id,uri:this.uri,loop:this.loop,start:this.start,end:this.end}},n.prototype.loadAudioBuffer=function(t){if(this.buffer)return window.setTimeout(t,0);var e=this,o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){if(4===~~o.readyState)return 200!==~~o.status&&0!==~~o.status?t("xhrError:"+o.status):void i.decodeAudioData(o.response,function(o){return e.buffer=o,t()},t)},o.open("GET",this.uri,!0),o.send()},e.exports=n},{"../core/audioContext":15}],20:[function(t,e,o){var n=t("domUtils"),i=(t("./core/audioContext"),t("./data/BufferData"));n.removeDom($screen.canvas,document.body),i.initializeDatabase(window.assets.buffers),t("./core/AudioConnector"),t("./core/EventConnector"),t("./ui/bufferLibrary"),t("./ui/menuHeader"),t("./ui/audioEditor").setBuffer(window.assets.buffers["damu drums1"]),t("./modules/TestModule"),t("./modules/Oscillator"),t("./modules/LFO"),t("./modules/Gain"),t("./modules/Panner"),t("./modules/ModPanner"),t("./modules/Sampler"),t("./modules/Filter"),t("./modules/Delay"),t("./modules/Volume"),t("./modules/Context"),document.body.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},!1),document.body.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault();var e=t.dataTransfer.files,o=e[0],n=new FileReader;n.onload=function(t){var e=t.target.result;try{var o=JSON.parse(e);o._type&&"modularPatch"===o._type&&window.moduleManager.setPatch(o)}catch(t){console.error(t)}},n.readAsText(o)},!1)},{"./core/AudioConnector":7,"./core/EventConnector":12,"./core/audioContext":15,"./data/BufferData":19,"./modules/Context":21,"./modules/Delay":22,"./modules/Filter":23,"./modules/Gain":24,"./modules/LFO":25,"./modules/ModPanner":26,"./modules/Oscillator":27,"./modules/Panner":28,"./modules/Sampler":29,"./modules/TestModule":30,"./modules/Volume":31,"./ui/audioEditor":33,"./ui/bufferLibrary":34,"./ui/menuHeader":36,domUtils:5}],21:[function(t,e,o){function n(){this.node=i,r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"Context",name:"Context",size:1,inputs:{DEST:{type:"audio",x:3,y:0,endPoint:"node.destination",label:"DEST"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],22:[function(t,e,o){function n(){this.node=i.createDelay(1),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"Delay",name:"Delay",size:3,inputs:{IN:{type:"audio",x:0,y:1,endPoint:"node",label:"IN"}},outputs:{OUT:{type:"audio",x:3.6,y:1,endPoint:"node",label:"OUT"}},controls:{delay:{type:"knob",x:2,y:.3,min:.01,max:1,endPoint:"node.delayTime",value:"value",label:"TIME"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],23:[function(t,e,o){function n(){this.node=i.createBiquadFilter(),this._filterType=0,this.node.type=a[this._filterType].id,r.call(this),this.$$type.setTitle(a[this._filterType].caption)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary"),a=[{id:"lowpass",caption:"LP"},{id:"highpass",caption:"HP"},{id:"bandpass",caption:"BP"}];inherits(n,r),n.prototype.switchType=function(){this.filterType+=1},Object.defineProperty(n.prototype,"filterType",{get:function(){return this._filterType},set:function(t){this._filterType=t%a.length,this.node.type=a[this._filterType].id,this.$$type.setTitle(a[this._filterType].caption)}}),n.prototype.descriptor={type:"Filter",name:"Filter",size:4,inputs:{IN:{type:"audio",x:.5,y:3,endPoint:"node",label:"IN"}},outputs:{OUT:{type:"audio",x:3,y:3,endPoint:"node",label:"OUT"}},controls:{cut:{type:"knob",x:2,y:.3,min:10,max:8e3,endPoint:"node.frequency",value:"value",label:"CUT"},res:{type:"knob",x:4,y:.3,min:0,max:40,endPoint:"node.Q",value:"value",label:"REZ"},type:{type:"button",x:.2,y:1.2,endPoint:"switchType"}},persistent:["filterType"]},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],24:[function(t,e,o){function n(){this.node=i.createGain(),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"Gain",name:"Gain x100",size:3,inputs:{IN:{type:"audio",x:3.5,y:.2,endPoint:"node",label:"IN"}},outputs:{OUT:{type:"audio",x:3.5,y:2,endPoint:"node",label:"OUT"}},controls:{gain:{type:"knob",x:1.5,y:.5,min:1,max:100,endPoint:"node.gain",value:"value",label:"GAIN"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],25:[function(t,e,o){function n(){this.node=i.createOscillator(),this.node.frequency.value=2,this.node.start(),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"LFO",name:"LFO",size:3,inputs:{},outputs:{OUT:{type:"audio",x:5,y:1,endPoint:"node",label:null}},controls:{frequency:{type:"knob",x:2.2,y:.3,min:.001,max:10,endPoint:"node.frequency",value:"value",label:"FREQ"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],26:[function(t,e,o){function n(){this.node=i.createStereoPanner(),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"ModPanner",name:"ModPan",size:2,inputs:{IN:{type:"audio",x:3.5,y:0,endPoint:"node",label:"IN"},pan:{type:"audio",x:0,y:1,endPoint:"node.pan",label:"PAN"}},outputs:{OUT:{type:"audio",x:3.5,y:1,endPoint:"node",label:"OUT"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],27:[function(t,e,o){function n(){this.node=i.createOscillator(),this.node.frequency.value=220,this.node.start(),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"Oscillator",name:"Oscillator",size:3,inputs:{detune:{type:"audio",x:0,y:1,endPoint:"node.detune",label:"DTN"}},outputs:{OUT:{type:"audio",x:0,y:2,endPoint:"node",label:"OUT"}},controls:{frequency:{type:"knob",x:3.7,y:.3,min:110,max:880,endPoint:"node.frequency",value:"value",label:"FREQ"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],28:[function(t,e,o){function n(){this.node=i.createStereoPanner(),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"Panner",name:"Pan",size:2,inputs:{IN:{type:"audio",x:3.5,y:0,endPoint:"node",label:"IN"}},outputs:{OUT:{type:"audio",x:3.5,y:1,endPoint:"node",label:"OUT"}},controls:{pan:{type:"knob",x:1.5,y:0,min:-1,max:1,endPoint:"node.pan",value:"value"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],29:[function(t,e,o){function n(){this.node=i.createBufferSource(),this.bufferData=null,r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.setBuffer=function(t){if("buffer"===t._type){if(this.bufferData){var e=this.node.playbackRate.value;this.node.disconnect(),this.node=i.createBufferSource(),this.bufferData=null,this.node.playbackRate.value=e,this.rebind()}this.bufferData=t.buffer;var o=this.bufferData.buffer,n=this.bufferData.loop||!1;if(this.node.buffer=o,this.node.loop=n,n){var r=this.bufferData.start||0,s=this.bufferData.end||o.duration;s<0&&(s=o.duration+s),s<0&&(s=0),this.node.loopStart=r,this.node.loopEnd=s}this.node.start()}},n.prototype.descriptor={type:"Sampler",name:"Sampler",size:3,inputs:{buffer:{type:"event",x:0,y:1,endPoint:"setBuffer",label:"BUF",singleConnection:!0}},outputs:{OUT:{type:"audio",x:0,y:2,endPoint:"node",label:"OUT"}},controls:{rate:{type:"knob",x:3.7,y:.3,min:.01,max:2,endPoint:"node.playbackRate",value:"value",label:"RATE"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],30:[function(t,e,o){function n(){i.call(this)}var i=t("../core/Module"),r=t("../ui/moduleLibrary"),s=t("domUtils");s.createDiv,s.createDom,s.removeDom,s.makeButton;inherits(n,i),n.prototype.doStuff=function(t){"color"===t._type&&(this._title.textContent="#"+t.hex,this._dom.style.backgroundColor="#"+t.hex)},n.prototype.onConnect=function(t){console.log("module has connected",this,t)},n.prototype.pushButton=function(){var t=("000"+(~~(4096*Math.random())).toString(16)).substr(-3);this.$B.emit({_type:"color",hex:t})},n.prototype.descriptor={type:"TestModule",name:"TestModule",size:5,inputs:{A:{type:"event",x:.2,y:1,label:"A",endPoint:"doStuff"}},outputs:{B:{type:"event",x:3.2,y:1,label:"B",onConnect:"onConnect"}},controls:{a:{type:"knob",x:.1,y:2.3,label:"KNB"},b:{type:"knob",x:2.1,y:2.3,label:"KNB"},c:{type:"button",x:4.1,y:2.3,label:"BTN",endPoint:"pushButton"}}},r.register(n),e.exports=n},{"../core/Module":14,"../ui/moduleLibrary":37,domUtils:5}],31:[function(t,e,o){function n(){this.node=i.createGain(),r.call(this)}var i=t("../core/audioContext"),r=t("../core/Module"),s=t("../ui/moduleLibrary");inherits(n,r),n.prototype.descriptor={type:"Volume",name:"Volume",size:3,inputs:{IN:{type:"audio",x:3.5,y:.2,endPoint:"node",label:"IN"}},outputs:{OUT:{type:"audio",x:3.5,y:2,endPoint:"node",label:"OUT"}},controls:{volume:{type:"knob",x:1.5,y:.5,min:0,max:1,endPoint:"node.gain",value:"value",label:"VOL"}}},s.register(n),e.exports=n},{"../core/Module":14,"../core/audioContext":15,"../ui/moduleLibrary":37}],32:[function(t,e,o){function n(){this._dom=r("panel");var t=r("handle",this._dom);s(t,this._dom)}var i=t("domUtils"),r=i.createDiv,s=i.makeDragable;e.exports=n},{domUtils:5}],33:[function(t,e,o){function n(){i.call(this),this.zoom=1,this.offset=0,this.bufferData=null,this.scroll=a("hscroll",this._dom),this.scroll.style.width=u+"px",this.scrollContent=a("",this.scroll),this.scrollContent.style.width=~~(u/this.zoom)+"px",this.scrollContent.style.height="2px";var t=this;this.scroll.addEventListener("scroll",function(){t.onScroll()}),this.canvas=s("canvas","waveform",this._dom),this.canvas.width=u,this.canvas.height=l,this.canvas.style.width=u+"px",this.canvas.style.height=l+"px",this.canvas.style.marginTop="2px",this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("wheel",function(e){t.onWheel(e.deltaY)})}var i=t("./Panel"),r=t("domUtils"),s=r.createDom,a=r.createDiv,u=(r.makeDragable,600),l=200,c=~~(l/2);inherits(n,i),n.prototype.onScroll=function(){var t=this.scroll.scrollLeft;if(this.bufferData&&this.bufferData.buffer){var e=u/this.zoom;this.offset=~~(this.bufferData.buffer.length*t/e),this.drawWaveform()}},n.prototype.onWheel=function(t){if(this.bufferData&&this.bufferData.buffer){var e=.03125,o=this.zoom;this.zoom*=t<0?.625:1.6,this.zoom=Math.max(e,Math.min(1,this.zoom)),this.zoom!==o&&(this.offset=Math.min(this.offset,~~(this.bufferData.buffer.length*(1-this.zoom))),this.scrollContent.style.width=~~(u/this.zoom)+"px",this.drawWaveform())}},n.prototype.drawWaveform=function(){var t=this.bufferData.buffer.getChannelData(0),e=this.bufferData.buffer.length,o=e*this.zoom/u;this.ctx.fillStyle="#05f5a7",this.ctx.clearRect(0,0,u,l);for(var n=1,i=-1,r=0;r<u;r++){for(var s=0;s<o;s++){var a=t[~~(this.offset+r*o+s)];a>i&&(i=a),a<n&&(n=a)}var d=~~((i-n)*c);d<1&&(d=1),this.ctx.fillRect(r,c-~~(i*c),1,d);var h=n;n=i,i=h}this.ctx.fillStyle="rgba(200,200,200,0.4)",this.ctx.fillRect(0,c,u,1),this.ctx.fillStyle="#F00";var p=this.bufferData.buffer.duration,f=this.bufferData.end;f<0&&(f=p+f);var m=p*this.zoom,v=this.offset/o,y=this.bufferData.start/m;f/=m,this.ctx.fillRect(u*y-v,0,1,l),this.ctx.fillRect(u*f-v,0,1,l)},n.prototype.setBuffer=function(t){var e=this;this.bufferData=t,t.loadAudioBuffer(function(t){t||e.drawWaveform()})},e.exports=new n},{"./Panel":32,domUtils:5}],34:[function(t,e,o){function n(){i.call(this),this.list=u("libraryList",this._dom),this.createEntries()}var i=t("./Panel"),r=t("../core/moduleManager"),s=t("../core/Buffer"),a=t("domUtils"),u=a.createDiv;inherits(n,i),n.prototype.createEntry=function(t){var e=u("libraryEntry",this.list);e.textContent=t.id,e.addEventListener("mousedown",function(e){var o=r.addModule(new s(t));r.startDrag(o,e)})},n.prototype.createEntries=function(){var t=window.assets.buffers;for(id in t)this.createEntry(t[id])},e.exports=new n},{"../core/Buffer":8,"../core/moduleManager":18,"./Panel":32,domUtils:5}],35:[function(t,e,o){function n(){this.dom=r("connectorMenu"),this.selected=null;var t=this;this.dom.addEventListener("mouseleave",function(){t.hide()})}var i=t("domUtils"),r=i.createDiv,s=i.makeButton;n.prototype.hide=function(){this.dom.style.display="none",this.dom.innerHTML="",this.selected=null},n.prototype.addEntry=function(t){var e=r("connectorMenuEntry",this.dom);return e.innerText=t,e.id=t,e},n.prototype.addDisconnectEntry=function(t,e){var o=this.addEntry(e),n=window.moduleManager,i=this;o.addEventListener("mousedown",function(){n.removeCable(t),i.hide()});var r=t.color;o.addEventListener("mouseleave",function(){t.color=r,n.drawCables()}),o.addEventListener("mouseenter",function(){t.color="#FFF",n.drawCables()})},n.prototype.show=function(t,e,o,n){if(this.selected=o,this.dom.style.left=Math.max(0,t-10)+"px",this.dom.style.top=Math.max(0,e-10)+"px",this.dom.style.display="block",this.dom.innerHTML="",1===n.length)return void this.addDisconnectEntry(n[0],"Disconnect");var i=this.addEntry("Disconnect all");r("connectorMenuSeparator",this.dom);var a=this;s(i,function(){a.hide();for(var t=0;t<n.length;t++)window.moduleManager.removeCable(n[t])});for(var u=[],l=0;l<n.length;l++)u.push(n[l].color);i.addEventListener("mouseleave",function(){for(var t=0;t<n.length;t++)n[t].color=u[t];moduleManager.drawCables()}),i.addEventListener("mouseenter",function(){for(var t=0;t<n.length;t++)n[t].color="#FFF";moduleManager.drawCables()});for(var l=0;l<n.length;l++){var c=n[l],d=c.endPointA===o?c.endPointB:c.endPointA,h=d.module.descriptor.name+":"+d.id;this.addDisconnectEntry(c,h)}},e.exports=new n},{domUtils:5}],36:[function(t,e,o){function n(){var t=window.moduleManager.getPatch(),e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),o=d("a");o.setAttribute("href",e),o.setAttribute("download","patch.json"),o.click(),h(o)}function i(){}function r(){m._currentSubmenu&&(m._currentSubmenu.style.display="none",m._currentSubmenu=null,v=Date.now())}function s(t,e){if("separator"===t.type)return void c("submenuSeparator",e);var o=c("submenuItem",e);o.innerText=t.label,p(o,function(){t.click&&t.click(),r()})}function a(t){function e(){return m._currentSubmenu===i?void r():(r(),m._currentSubmenu=i,void(i.style.display=""))}if(t.label){var o=c("menuItem",m);o.innerText=t.label;var n=t.submenu;if(n){var i=c("submenu",o);i.style.display="none";for(var a=0;a<n.length;a++)s(n[a],i)}p(o,function(){e(),t.click&&t.click()}),o.addEventListener("mouseleave",r),o.addEventListener("mouseenter",function(){Date.now()<v+300&&e()})}}function u(t){for(var e=0;e<t.length;e++){var o=t[e];a(o)}}var l=t("domUtils"),c=l.createDiv,d=l.createDom,h=l.removeDom,p=l.makeButton,f=[{label:"Patch",submenu:[{label:"Load Pacth",click:null},{label:"Save Pacth",click:null},{type:"separator"},{label:"Import Patch",click:i},{label:"Export Patch",click:n},{type:"separator"},{label:"Clear Patch",click:function(){window.moduleManager.clearPatch()}}]},{label:"View",submenu:[{label:"Modules",type:"checkbox",checked:!0},{label:"Buffers",type:"checkbox",checked:!0},{label:"Controls",type:"checkbox",checked:!0},{label:"Inspector",type:"checkbox",checked:!0}]}],m=c("menuHeader",null);m._currentSubmenu=null;var v=0;u(f)},{domUtils:5}],37:[function(t,e,o){function n(){i.call(this),this._dom.style.left="150px",this.list=a("libraryList",this._dom)}var i=t("./Panel"),r=t("../core/moduleManager"),s=t("domUtils"),a=s.createDiv,u={};inherits(n,i),n.prototype.register=function(t){var e=t.prototype.descriptor;if(u[e.type]=t,e.name){var o=a("libraryEntry",this.list);o.textContent=e.name,o.addEventListener("mousedown",function(e){var o=r.addModule(new t);r.startDrag(o,e)})}},n.prototype.getModuleConstructor=function(t){return u[t]};var l=new n;e.exports=l,r.moduleLibrary=l},{"../core/moduleManager":18,"./Panel":32,domUtils:5}],38:[function(t,e,o){function n(t){t.height=window.innerHeight,t.width=window.innerWidth,t.style.width=t.width+"px",t.style.height=t.height+"px"}var i=document.getElementById("cableCanvas"),r=document.getElementById("overlayCanvas"),s=i.getContext("2d"),a=r.getContext("2d");n(i),n(r),s.lineCap="round",s.shadowColor="#000",s.shadowBlur=3,s.lineWidth=3,s.shadowOffsetX=1,s.shadowOffsetY=1,a.lineWidth=3,a.strokeStyle="#444",a.lineCap="butt",a.setLineDash([3,3]),o.ctx=s,o.overCtx=a},{}],39:[function(t,e,o){function n(){}function i(){for(var t=0;t<x;t++)v[b[t]]=!1,y[b[t]]=!1}function r(t,e){var o=f[t];o&&(e&&!m[o]&&(v[o]=!0),!e&&m[o]&&(y[o]=!0),m[o]=e)}function s(t,e,o){var n=new d(t,e),i=n.canvas;document.body.appendChild(i);var r=i.style;return r.width=t*o[0]+"px",r.height=e*o[1]+"px",n}function a(e,o){function n(){r.update(),i(),_(n)}if(paper(0).pen(1).cls(),e)return print(e),console.error(e);window.assets=o,o.tilesheet&&tilesheet(o.tilesheet),h.loadBank(o.maps);var r=t("../src/main.js");r.update&&(i(),n())}function u(t,e,o,n){rectfill(C-M,E-2,~~(n*M*2),4)}var l=t("../settings.json");window.settings=l;var c=t("assetLoader"),d=t("Texture"),h=t("Map"),p=t("EventEmitter");window.EventEmitter=p,window.inherits=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})};window.sfx=n,window.music=n,window.audioManager={addChannel:n,loadSound:n,playLoopSound:n,playSound:n,playSoundGroup:n,release:n,setMute:n,setVolume:n,setup:n,stopAllLoopSounds:n,stopLoopSound:n,settings:{}};var f={},m=window.btn={},v=window.btnp={},y=window.btnr={},b=[],x=0;!function(){var t=l.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t){var o=t[e];f[o]=e,m[e]=!1,v[e]=!1,y[e]=!1,b.push(e)}x=b.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),r(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),r(t.keyCode,!1)}),window.texture=function(t){var e=new d(t.width,t.height);return e.ctx.drawImage(t,0,0),e},window.tilesheet=function(t){return d.prototype.setGlobalTilesheet(t)};var g=window.$screen=s(l.screen.width,l.screen.height,l.screen.pixelSize);g.setPalette(l.palette),window.cls=function(){return g.cls()},window.sprite=function(t,e,o,n,i,r){return g.sprite(t,e,o,n,i,r)},window.draw=function(t,e,o,n,i,r){return g.draw(t,e,o,n,i,r)},window.rect=function(t,e,o,n){return g.rect(t,e,o,n)},window.rectfill=function(t,e,o,n){return g.rectfill(t,e,o,n)},window.camera=function(t,e){return g.setCamera(t,e)},window.pen=function(t){return g.pen(t)},window.paper=function(t){return g.paper(t)},window.locate=function(t,e){return g.locate(t,e)},window.print=function(t,e,o){return g.print(t,e,o)},window.println=function(t){return g.println(t)},window.getMap=h.getMap,window.chr$=function(t){return String.fromCharCode(t)},window.clip=function(t,e,o){return Math.max(e,Math.min(o,t))},window.random=function(t){return~~Math.round(t*Math.random())};var w=1/60,_=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,w)},C=~~(l.screen.width/2),M=~~(l.screen.width/4),E=~~(l.screen.height/2),D=l.loaderColors||[0,1];Array.isArray(D)||(D=[0,1]);var P=~~D[0],L=~~D[1];paper(P).cls().paper(L).pen(L),rect(C-M-2,E-4,2*M+4,8),c.preloadStaticAssets(a,u)},{"../settings.json":6,"../src/main.js":20,EventEmitter:1,Map:2,Texture:3,assetLoader:4}]},{},[39]);